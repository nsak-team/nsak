# NSAK Rogue AP Scenario

This document describes how to execute the Rogue Access Point scenario using NSAK and how to enable or disable
individual drills at runtime without modifying code or rebuilding container images.

## 1. Prerequisites

- Linux host (tested on NanoPi / BananaPi)
- Podman
- Python environment with nsak installed
- Root privileges (required for networking operations)

## 2. Scenario Overview

The Rogue AP scenario consists of the following drills:

Drill name Purpose:
- ap_mod Starts hostapd and creates the rogue access point
- network_setup Assigns static IP to the AP interface
- dnsmasq Provides DHCP and DNS services
- nat_forwarding Enables NAT for internet access
- tshark_capture Captures traffic into a PCAP file

By default, all drills are executed.

## 3. Required Environment Variables

The following environment variables must be set for the scenario to run depending on your needs:

- NSAK_AP_IF=wlan0
- NSAK_UPLINK_IF=eth1
- NSAK_SSID="BFH-Open"
- NSAK_CHANNEL=6
- NSAK_COUNTRY=CH

## 4. Running the Scenario (All Drills Enabled)

```
   sudo -E env \
   PATH="/home/pi/swiss-army-knife-network-sniffer/.venv/bin:$PATH" \
   PYTHONPATH="$PWD" \
   NSAK_AP_IF=wlan0 \
   NSAK_UPLINK_IF=eth1 \
   NSAK_SSID="BFH-Open" \
   NSAK_CHANNEL=6 \
   NSAK_COUNTRY=CH \
   nsak scenario execute rogue_ap_scenario
```

**Result**

- Rogue AP is visible
- Clients receive IP addresses
- Internet access via NAT is available
- Traffic is captured to a PCAP file

## 5. Disabling Individual Drills (Blacklist Mode)

Drills can be disabled at runtime using the environment variable:

NSAK_DISABLE_DRILLS

Multiple drills are comma-separated.

Example: Disable Traffic Capture
NSAK_DISABLE_DRILLS=tshark_capture

```
sudo -E env \
PATH="/home/pi/swiss-army-knife-network-sniffer/.venv/bin:$PATH" \
PYTHONPATH="$PWD" \
NSAK_DISABLE_DRILLS=tshark_capture \
NSAK_AP_IF=wlan0 \
NSAK_UPLINK_IF=eth1 \
NSAK_SSID="BFH-Open" \
NSAK_CHANNEL=6 \
NSAK_COUNTRY=CH \
nsak scenario execute rogue_ap_scenario
```

No PCAP file is created.

Example: Disable DHCP/DNS and NAT
NSAK_DISABLE_DRILLS=dnsmasq,nat_forwarding

Clients can associate with the AP but receive no IP address or internet access.

## 6. Available Drill Names

Use drill names, not tool names:

*Drill Description*

ap_mod: hostapd / access point
network_setup: interface IP setup
dnsmasq: DHCP + DNS
nat_forwarding: iptables NAT
tshark_capture: packet capture

## 7. Containerization

NSAK scenarios can be built and executed as privileged containers to ensure isolation, reproducibility, and a clean
runtime environment for network experiments.

Each scenario is packaged as a dedicated container image and executed using Podman with host networking enabled.

`nsak scenario build rogue_ap_scenario`

**This command:**

- Builds a scenario-specific container image
- Installs all required tools (e.g. hostapd, dnsmasq, tshark)
- Embeds the scenario and drill logic
- Prepares the image for reproducible execution
- Running the Scenario in a Container

The scenario is executed by starting the container via NSAK.
All required configuration is passed via environment variables.

```
NSAK_AP_IF=wlan0 \
NSAK_UPLINK_IF=eth1 \
NSAK_SSID="BFH-Open" \
NSAK_CHANNEL=6 \
NSAK_COUNTRY=CH \
nsak scenario run rogue_ap_scenario
NSAK_DISABLE_DRILLS=tshark_capture *optional
```
During execution:

The container runs in privileged mode
Host networking (--network=host) is used
Runtime data is written to /run/nsak inside the container
/run/nsak is mounted to a host directory for persistence

Runtime Artifacts

All runtime artifacts generated by the scenario (configuration files, DHCP leases, packet captures) are written to the
mounted runtime directory, for example:

/home/pi/nsak-data/rogue_ap_scenario/

- hostapd/
- dnsmasq/
- captures/

This allows post-execution analysis without accessing the container directly.

**Notes**

1. Only one container instance per scenario can run at a time
2. Existing containers with the same scenario name are removed before startup
3. Each execution starts from a clean container state
4. No container rebuild is required when enabling or disabling drills at runtime
5. To learn more about the drills and execution `sudo podman logs rogue_ap_scenario`
