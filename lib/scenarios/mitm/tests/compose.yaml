version: "3.9"

services:
  malcom:
    image: nsak/scenario/mitm:latest
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      testnet:
        ipv4_address: 10.10.10.10
    privileged: true
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped

  alice:
    image: python:3.13-alpine
    volumes:
      - .:/usr/src/app/
    command: python /usr/src/app/alice.py
    depends_on:
      - malcom
    networks:
      testnet:
        ipv4_address: 10.10.10.20
    environment:
      - PYTHONUNBUFFERED=1

  bob:
    image: python:3.13-alpine
    volumes:
      - .:/usr/src/app/
    command: python /usr/src/app/bob.py
    depends_on:
      - malcom
    networks:
      testnet:
        ipv4_address: 10.10.10.30
    environment:
      - PYTHONUNBUFFERED=1

networks:
  testnet:
    driver: macvlan
    driver_opts:
      parent: wlan0
    ipam:
      config:
        - subnet: 10.10.10.0/24
          gateway: 10.10.10.1
